<html>
    <head>
        <meta charset="utf-8">
  
        <!-- Load d3.js & color palette-->
        <script src="https://d3js.org/d3.v4.js"></script>
        <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
        <link rel="stylesheet" href="style.css">
      
        <h1>Still thinkin' about it...</h1>
    </head>
    <body>
        <div id="viz3"></div>
    </body>

    <script>
        var margin = {top: 30, right: 70, bottom: 150, left: 70},
            width = 700 - margin.left - margin.right,
            height = 700 - margin.top - margin.bottom;

        var svgD = d3.select("#viz3")
        .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
        .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

    d3.csv("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/data_connectedscatter.csv", function(data) {

        var listBrands = ["BudLight","Budweiser","Coca Cola","Doritos","E-Trade","Hynundai","Kia","NFL","Pepsi","Toyota"];
        var dropMenu = d3.select("#viz3")
        .append('select')

        dropMenu.selectAll('myOptions') 
            .data(listBrands)
        .enter()
            .append('option')
        .text(function (d) { return d; }) 
        .attr("value", function (d) { return d; })

        // Add X axis --> it is a date format
        var x = d3.scaleLinear()
        .domain([2000,2020])
        .range([ 0, width ]);
        svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x));

        // Add Y axis
        var y = d3.scaleLinear()
        .domain( [0,20])
        .range([ height, 0 ]);
        svg.append("g")
        .call(d3.axisLeft(y));

        // Initialize line with group a
        var line = svg
        .append('g')
        .append("path")
            .datum(data)
            .attr("d", d3.line()
            .x(function(d) { return x(+d.time) })
            .y(function(d) { return y(+d.valueA) })
            )
            .attr("stroke", "black")
            .style("stroke-width", 4)
            .style("fill", "none")

        // Initialize dots with group a
        var dot = svg
        .selectAll('circle')
        .data(data)
        .enter()
        .append('circle')
            .attr("cx", function(d) { return x(+d.time) })
            .attr("cy", function(d) { return y(+d.valueA) })
            .attr("r", 7)
            .style("fill", "#69b3a2")


        // A function that update the chart
        function update(selectedGroup) {

        // Create new data with the selection?
        var dataFilter = data.map(function(d){return {time: d.time, value:d[selectedGroup]} })

        // Give these new data to update line
        line
            .datum(dataFilter)
            .transition()
            .duration(1000)
            .attr("d", d3.line()
                .x(function(d) { return x(+d.time) })
                .y(function(d) { return y(+d.value) })
            )
        dot
            .data(dataFilter)
            .transition()
            .duration(1000)
            .attr("cx", function(d) { return x(+d.time) })
            .attr("cy", function(d) { return y(+d.value) })
        }

        // When the button is changed, run the updateChart function
        d3.select("#selectButton").on("change", function(d) {
            // recover the option that has been chosen
            var selectedOption = d3.select(this).property("value")
            // run the updateChart function with this selected option
            update(selectedOption)

            })
        })


    </script>

</html>