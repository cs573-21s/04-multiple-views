<!doctype html>
<html lang="en">
<head>
  <title>CS573 a4</title>
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  <style>
    body {
      margin: 0px; 
      width: 100vw; 
      height: 100vh;
    }

    .svg-container {
      display: inline-block;
      position: relative;
      width: 100vw;
      height: 100vh;
      vertical-align: top;
      overflow: hidden;
    }

    .svg-content {
      display: inline-block;
      position: absolute;
      top: 0;
      left: 0;
    }

    text {
        font-family: sans-serif;
        font-weight: bold;
    }

  </style>
</head>
<body>
    <div id="container" class="svg-container">
    </div>

    <script>
        console.log(d3);

        // how to load 2 datasets
        Promise.all([
            d3.json('states.json'),
            d3.csv('state_data.csv')
        ]).then (([states, totals]) => {
            createMap(states, totals)
        })
        
        var colorScale = d3.scaleThreshold()
            .domain([100000, 1000000, 10000000, 30000000, 100000000, 500000000])
            .range(d3.schemeBlues[7]);

        function createMap(states, totals) {
            console.log(states);
            console.log(totals);

            var proj = d3.geoMercator()
                .translate([2000,1200])
                .scale(620);

            var gpath = d3.geoPath()
                .projection(proj);

            /*
            console.log(
                gpath.area(states.features[0])
            );
            */

            d3.select('svg')
              .selectAll('path')
              .data(states.features)
              .enter()
              .append('path')
                .attr('d', function(d) { return gpath(d); })
                .attr('stroke-width',1)
                .attr('stroke','#252525')
                .attr('id', d => d.id)
                .attr('fill', function(d) {
                    if (d.features.NAME == totals)
                    d.total = totals.state_breweries || 0;
                    return colorScale(d.total)
                })
        }
        
        var svg = d3.select('div#container').append('svg')
            .attr('viewBox', '0 0 1920 1080')
            .attr('preserveAspectRatio', 'xMinYMin meet')
            .classed('svg-content', true)

        
        
    </script>
</body>
</html>