<html>

<head>
  <meta charset="utf-8">
  
  <!-- Load d3.js & color palette-->
  <script src="https://d3js.org/d3.v4.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  <link rel="stylesheet" href="style.css">

</head>
<body>
  <!--where the graph will be-->
  <div class="container">
    <div id="viz1"></div>
    <div id="viz2"></div>
    <div id="viz3"></div>
  </div>    


</body>

<script>

// set the dimensions and margins of the graph
var margin = {top: 100, right: 100, bottom: 100, left: 100},
    width = 700 - margin.left - margin.right,
    height = 700 - margin.top - margin.bottom;

var svg = d3.select("#viz1")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

var svgG = d3.select("#viz2")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

var listBrands = ["BudLight","Budweiser","Coca Cola","Doritos","E-Trade","Hynundai","Kia","NFL","Pepsi","Toyota"];
var dropMenu = d3.select("#viz3")
  .append('select')

dropMenu.selectAll('myOptions') 
 	.data(listBrands)
  .enter()
	.append('option')
  .text(function (d) { return d; }) 
  .attr("value", function (d) { return d; })

// Parse the Data
d3.csv("https://raw.githubusercontent.com/geacquista/04-multiple-views/main/superbowl-ads.csv", function(data) {

  var subgroups = data.columns.slice(1)
  var groups = d3.map(data, function(d){return(d.brand)}).keys()
  
  // Add X axis
  var x = d3.scaleBand()
      .domain(groups)
      .range([0, width])
      .padding([0.3])
  svg.append("g")
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(x).tickSizeOuter(0))
   // .domain(["Bud Light", "Budweiser","Coke", "Doritos", "])

  // Add Y axis
  var y = d3.scaleLinear()
    .domain([0, 200])
    .range([ height, 0 ]);
  svg.append("g")
    .call(d3.axisLeft(y));

  var x1 = d3.scaleBand()
    .range([ 0, width ])
    .domain(data.map(function(d) { return d.brand; }))
    .padding([0.3]);
  var xAx = svgG.append("g")
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(x1).tickSizeOuter(0));

  var y1 = d3.scaleLinear()
    .range([ height, 0])
    .domain([0, 200]);
  var yAx = svgG.append("g")
    .attr("class", "myY")
    .call(d3.axisLeft(y));

  // color palette = one color per subgroup
  var color = d3.scaleOrdinal()
    .domain(subgroups)
    .range(d3.schemeSet3);

  //stack the data? --> stack per subgroup
  var stackedData = d3.stack()
    .keys(subgroups)
    (data)


  var Tooltip = d3.select("#viz1")
    .append("div")
    .style("opacity", 0)
    .attr("class", "tooltip")
    .style("background-color", "white")
    .style("border", "solid")
    .style("border-width", "2px")
    .style("border-radius", "5px")
    .style("padding", "5px")


  // ----------------
  // Highlight a specific subgroup when hovered
  // ----------------

  var mouseover = function(d) {

    var groupNames = d3.select(this.parentNode).datum().key;
    var groupNameValue = d.data[groupNames];

    d3.selectAll(".myRect").style("opacity", 0.2)
    d3.selectAll("." + groupNames)
      .style("opacity", 1)  
      
    y1.domain([0, 60]);
    yAx.transition().duration(1000).call(d3.axisLeft(y1)); 

    if (groupNames === "funny") {
     
      svgG.selectAll("mybar")
          .data(data)
            .enter()
            .append("rect")
            .transition() 
            .duration(1000)
              .attr("x", function(d) { return x1(d.brand); })
              .attr("y", function(d) { return y1(d.funny); })
              .attr("width", x1.bandwidth())
              .attr("height", function(d) { return height - y1(d.funny); })
              .attr("fill", "rgb(141, 211, 199)")
              .attr("stroke", "grey")

    }

    else if (groupNames === "quick_show") {
    
      svgG.selectAll("mybar")
          .data(data)
            .enter()
            .append("rect")
            .transition() 
            .duration(1000)
              .attr("x", function(d) { return x1(d.brand); })
              .attr("y", function(d) { return y1(d.quick_show); })
              .attr("width", x1.bandwidth())
              .attr("height", function(d) { return height - y1(d.quick_show); })
              .attr("fill", "rgb(255, 255, 179)")
              .attr("stroke", "grey")

    }

    else if (groupNames === "patriotic") {
     
      svgG.selectAll("mybar")
          .data(data)
            .enter()
            .append("rect")
            .transition() 
            .duration(1000)
              .attr("x", function(d) { return x1(d.brand); })
              .attr("y", function(d) { return y1(d.patriotic); })
              .attr("width", x1.bandwidth())
              .attr("height", function(d) { return height - y1(d.patriotic); })
              .attr("fill", "rgb(190, 186, 218)")
              .attr("stroke", "grey")

    }

    else if (groupNames === "celebrity") {
    
      svgG.selectAll("mybar")
          .data(data)
            .enter()
            .append("rect")
            .transition() 
            .duration(1000)
              .attr("x", function(d) { return x1(d.brand); })
              .attr("y", function(d) { return y1(d.celebrity); })
              .attr("width", x1.bandwidth())
              .attr("height", function(d) { return height - y1(d.celebrity); })
              .attr("fill", "rgb(251, 128, 114)")
              .attr("stroke", "grey")

    }

    else if (groupNames === "danger") {
    
      svgG.selectAll("mybar")
          .data(data)
            .enter()
            .append("rect")
            .transition() 
            .duration(1000)
              .attr("x", function(d) { return x1(d.brand); })
              .attr("y", function(d) { return y1(d.danger); })
              .attr("width", x1.bandwidth())
              .attr("height", function(d) { return height - y1(d.danger); })
              .attr("fill", "rgb(128, 177, 211)")
              .attr("stroke", "grey")


    }

    else if (groupNames === "animals") {
    
      svgG.selectAll("mybar")
          .data(data)
            .enter()
            .append("rect")
            .transition() 
            .duration(1000)
              .attr("x", function(d) { return x1(d.brand); })
              .attr("y", function(d) { return y1(d.animals); })
              .attr("width", x1.bandwidth())
              .attr("height", function(d) { return height - y1(d.animals); })
              .attr("fill", "rgb(253, 180, 98)")        
              .attr("stroke", "grey")

    
    }

    else if (groupNames === "use_sex") {
    
      svgG.selectAll("mybar")
          .data(data)
            .enter()
            .append("rect")
            .transition() 
            .duration(1000)
              .attr("x", function(d) { return x1(d.brand); })
              .attr("y", function(d) { return y1(d.use_sex); })
              .attr("width", x1.bandwidth())
              .attr("height", function(d) { return height - y1(d.use_sex); })
              .attr("fill", "rgb(179,222,105)")
              .attr("stroke", "grey")

    }  
    
    
  }

  var mousemove = function(d) {
    Tooltip
      .style("opacity", 1)
      .html("This stacked section represents <br> the number of funny <br> advertisements each company used.")
        .style("left", (d3.mouse(this)[0]+80) + "px")
        .style("top", (d3.mouse(this)[1]+20) + "px");
   }

  // When user do not hover anymore
  var mouseleave = function(d) {
    d3.selectAll(".myRect")
      .style("opacity", 1)

    svgG.selectAll("rect")
    .transition().duration(400)
    .attr("fill", "white")
    .attr("stroke", "none");

    Tooltip
      .style("opacity", 0)

  }


  // Show the bars
  svg.append("g")
    .selectAll("g")
    // Enter in the stack data = loop key per key = group per group
    .data(stackedData)
    .enter().append("g")
      .attr("fill", function(d) { return color(d.key); })
      .attr("class", function(d){ return "myRect " + d.key }) // Add a class to each subgroup: their name
      .selectAll("rect")
      // enter a second time = loop subgroup per subgroup to add all rectangles
      .data(function(d) { return d; })
      .enter().append("rect")
        .attr("x", function(d) { return x(d.data.brand); })
        .attr("y", function(d) { return y(d[1]); })
        .attr("height", function(d) { return y(d[0]) - y(d[1]); })
        .attr("width",x.bandwidth())
        .attr("stroke", "grey")
      .on("mouseover", mouseover)
      .on("mouseleave", mouseleave)
      .on("mousemove", mousemove)

})

</script>
</html>